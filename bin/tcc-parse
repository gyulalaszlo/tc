#!/usr/bin/env node

var winston = require('winston');
var program = require('commander');
var coffee = require('coffee-script/register');
var compiler = require('../src/compiler');

//
// Configure CLI output on the default logger
//
winston.cli();


program
  .option( '-r, --root [dir]', 'The root of the package tree', 'examples' )
  .option( '-p, --save-parse-tree', 'Save the parsed tree', false )
  .option( '-t, --save-type-tree', 'Save the type tree', false )

  .option( '-n, --save-normalized-form', 'Save the normalized form of types', false )

  .option('-v, --verbose', 'More status messages.')
  .parse(process.argv);

var pkgs = program.args;
if (!pkgs.length) {
  console.error('packages argument required required');
  process.exit(1);
}

compiler.compile_packages(pkgs, program, function( err, result){
  winston.info( "Result: ", result )
  if(err){
    winston.error("Got error: ",  err );
    winston.error( err.stack );
    process.exit(1);
  }
});
